# Razorpay

1. User click on Buy button :- when the user Clicks on the buy button it hits a POST request and submits the product ID to the server API. (/api/v1/create-order). The product ID is submitted to create an order.
2. Create order in server :- the server get the product ID searches in the database and get the product price. Now it becomes very important to create an order for that product in the razor pay using its API. Create an order with the product ID and the amount and as a result we get an order ID from Razerpay server. We even have created a transaction database collection where we live down all the necessary information for a particular order. We create a new transaction document and make it status property to 'started' .Then we generate a list of options with including order ID, amount, transaction ID in the notes and some colour design properties. This list of options are sent to the client. 
3. Client generate check out page :- the set of options which the client gets from the server it uses that set of options to create the check out page the most important thing is the order ID. The customer can now put its card details or upi and pay the money as soon as the customer pays money then after that we need to tell our server that the payment has been made. For this we utilised web hooks. We need to create a web hope on the razor pay and create a secret key.
4. webhook registered on the Razorpay :- the event this web hook is listening is event.payment.captured. Whenever a customer complete its transaction the payment becomes successful and the event associated with it is captured. So after a successful payment the event captured is called and as a result over web hook is called and then web hook will call our API on the which will be let's say "/api/verify-payment'. 
5. Server authorises the payment :- now we need to authenticate that the webbook which just initiated the verify payment API is set by us. At the time of registration of a book we created a secret even we have that secret on our server. razorpay uses SHA256 algorithm to hash the payload with the secret and take that hash and put it in the header has x-razorpay-signature. We need to utilise the Reserve functions to create a hash by similarly using our secret key and the payload we got from the webook. We will match the header signature as well as the hash created at the server side. If both the signature matches we will move forward or else we will break the connection. 
6. Addition of course to the student document :- If everything goes fine then entire payment process is successful and then we need to add the core side to the student document so that in the future we can know what the student has purchased.